<div class="container">
  <h1>Create a New Product</h1>

  <form [formGroup]="productForm" (ngSubmit)="onSubmit()">

    <div *ngIf="isUploading" class="upload-spinner">
      <mat-spinner></mat-spinner>
      <p>Creating product and uploading images, please wait...</p>
    </div>

    <ng-container *ngIf="!isUploading">

      <mat-form-field appearance="fill">
        <mat-label>Product Name</mat-label>
        <input matInput formControlName="name" required>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Description</mat-label>
        <textarea matInput formControlName="description" required></textarea>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Price</mat-label>
        <input matInput type="number" formControlName="price" required>
      </mat-form-field>

      <mat-form-field appearance="fill">
        <mat-label>Quantity</mat-label>
        <input matInput type="number" formControlName="quantity" required>
      </mat-form-field>

      <div class="form-group">
        <label for="images">Product Images (Max 2MB each)</label>
        <input type="file"
               id="images"
               (change)="onFilesSelected($event)"
               accept="image/png, image/jpeg, image/gif, image/webp"
               multiple>
      </div>

      <div class="file-errors" *ngIf="fileErrors.length > 0">
        <p *ngFor="let error of fileErrors">{{ error }}</p>
      </div>

      <div class="file-list" *ngIf="selectedFiles.length > 0">
        <p>Selected Files:</p>
        <ul>
          <li *ngFor="let file of selectedFiles; let i = index">
            <span>{{ file.name }} ({{ (file.size / 1024 / 1024) | number:'1.1-2' }} MB)</span>
            <button type="button" (click)="removeFile(i)" class="remove-btn">
              <mat-icon>cancel</mat-icon>
            </button>
          </li>
        </ul>
      </div>

      <button mat-raised-button color="primary" type="submit" [disabled]="!productForm.valid || selectedFiles.length === 0">
        Create Product
      </button>

    </ng-container>
  </form>
</div>
