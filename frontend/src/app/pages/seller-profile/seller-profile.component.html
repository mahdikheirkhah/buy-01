<div class="seller-profile-container">
  <mat-card class="profile-card">
    <mat-card-header>
      <mat-card-title>Shop Profile</mat-card-title>
      <button *ngIf="isOwnProfile" mat-icon-button (click)="toggleEditMode()" class="edit-btn">
        <mat-icon>{{ isEditMode ? 'close' : 'edit' }}</mat-icon>
      </button>
    </mat-card-header>

    <mat-card-content *ngIf="!isLoading && sellerProfile">
      <div class="profile-header">
        <div class="shop-logo">
          <img *ngIf="sellerProfile.shopLogoUrl" [src]="sellerProfile.shopLogoUrl" alt="Shop Logo" />
          <mat-icon *ngIf="!sellerProfile.shopLogoUrl">store</mat-icon>
        </div>

        <div class="shop-info" *ngIf="!isEditMode">
          <div class="name-and-badges">
            <h2>{{ sellerProfile.sellerName }}</h2>
            <span class="badge verification-badge">
              <mat-icon>{{ sellerProfile.isVerified ? 'verified' : 'info' }}</mat-icon>
              {{ verificationBadge }}
            </span>
            <span class="badge status-badge">
              <mat-icon>{{ sellerProfile.isActive ? 'check_circle' : 'cancel' }}</mat-icon>
              {{ statusBadge }}
            </span>
          </div>
          <p class="description">{{ sellerProfile.shopDescription || 'Welcome to our shop!' }}</p>
        </div>

        <form *ngIf="isEditMode" [formGroup]="profileForm" class="edit-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Shop Name</mat-label>
            <input matInput formControlName="sellerName" placeholder="Shop Name" />
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Shop Description</mat-label>
            <textarea matInput formControlName="shopDescription" placeholder="Describe your shop" rows="3"></textarea>
          </mat-form-field>
        </form>
      </div>

      <div class="statistics">
        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>attach_money</mat-icon>
            </div>
            <div class="stat-info">
              <h3>Total Revenue</h3>
              <p class="stat-value">{{ formattedRevenue }}</p>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>shopping_cart</mat-icon>
            </div>
            <div class="stat-info">
              <h3>Total Sales</h3>
              <p class="stat-value">{{ sellerProfile.totalSales }}</p>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>people</mat-icon>
            </div>
            <div class="stat-info">
              <h3>Total Customers</h3>
              <p class="stat-value">{{ sellerProfile.totalCustomers }}</p>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>star</mat-icon>
            </div>
            <div class="stat-info">
              <h3>Average Rating</h3>
              <p class="stat-value">{{ sellerProfile.averageRating.toFixed(1) }}/5</p>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>favorite</mat-icon>
            </div>
            <div class="stat-info">
              <h3>Followers</h3>
              <p class="stat-value">{{ sellerProfile.followerCount }}</p>
            </div>
          </mat-card-content>
        </mat-card>

        <mat-card class="stat-card">
          <mat-card-content>
            <div class="stat-icon">
              <mat-icon>rate_review</mat-icon>
            </div>
            <div class="stat-info">
              <h3>Total Reviews</h3>
              <p class="stat-value">{{ sellerProfile.totalReviews }}</p>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <mat-tab-group>
        <mat-tab label="Performance Metrics">
          <ng-template mat-tab-label>
            <mat-icon>bar_chart</mat-icon>
            <span>Performance Metrics</span>
          </ng-template>
          <mat-card class="metrics-card">
            <mat-card-content>
              <div class="metric-row">
                <span class="metric-label">Delivery Rating:</span>
                <div class="metric-bar-container">
                  <div class="metric-bar" [style.width.%]="sellerProfile.deliveryRating * 20">
                    <span class="metric-value">{{ sellerProfile.deliveryRating.toFixed(1) }}/5</span>
                  </div>
                </div>
              </div>
              <div class="metric-row">
                <span class="metric-label">Communication Rating:</span>
                <div class="metric-bar-container">
                  <div class="metric-bar" [style.width.%]="sellerProfile.communicationRating * 20">
                    <span class="metric-value">{{ sellerProfile.communicationRating.toFixed(1) }}/5</span>
                  </div>
                </div>
              </div>
              <div class="metric-row">
                <span class="metric-label">Return Rate:</span>
                <div class="metric-bar-container">
                  <div class="metric-bar negative" [style.width.%]="sellerProfile.returnRate * 100">
                    <span class="metric-value">{{ (sellerProfile.returnRate * 100).toFixed(1) }}%</span>
                  </div>
                </div>
              </div>
              <div class="metric-row">
                <span class="metric-label">Cancellation Rate:</span>
                <div class="metric-bar-container">
                  <div class="metric-bar negative" [style.width.%]="sellerProfile.cancellationRate * 100">
                    <span class="metric-value">{{ (sellerProfile.cancellationRate * 100).toFixed(1) }}%</span>
                  </div>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </mat-tab>

        <mat-tab label="Shop Information">
          <ng-template mat-tab-label>
            <mat-icon>info</mat-icon>
            <span>Shop Information</span>
          </ng-template>
          <mat-card class="info-card">
            <mat-card-content>
              <div class="detail-row">
                <span class="label">Shop Member Since:</span>
                <span class="value">{{ joinDateDisplay }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Last Sale Date:</span>
                <span class="value">{{ lastSaleDateDisplay }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Best Selling Product:</span>
                <span class="value">{{ sellerProfile.bestSellingProductName || 'Not available' }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Best Product Sales Count:</span>
                <span class="value">{{ sellerProfile.bestSellingProductCount }}</span>
              </div>
              <div class="detail-row">
                <span class="label">5-Star Reviews:</span>
                <span class="value">{{ sellerProfile.totalFiveStarReviews }}</span>
              </div>
              <div class="detail-row">
                <span class="label">Categories:</span>
                <div class="categories">
                  <span class="category-badge" *ngFor="let category of sellerProfile.categories">
                    {{ category }}
                  </span>
                </div>
              </div>
            </mat-card-content>
          </mat-card>
        </mat-tab>
      </mat-tab-group>

      <div *ngIf="isOwnProfile" class="actions">
        <button *ngIf="!isEditMode" mat-raised-button color="primary" (click)="toggleEditMode()">
          <mat-icon>edit</mat-icon>
          Edit Shop Info
        </button>
        <button *ngIf="isEditMode" mat-raised-button color="primary" (click)="saveProfile()" [disabled]="profileForm.invalid || isLoading">
          <mat-icon>save</mat-icon>
          Save Changes
        </button>
        <button *ngIf="isEditMode" mat-raised-button (click)="toggleEditMode()">
          <mat-icon>cancel</mat-icon>
          Cancel
        </button>
      </div>
    </mat-card-content>

    <mat-card-content *ngIf="isLoading" class="loading">
      <mat-icon>hourglass_empty</mat-icon>
      <p>Loading seller profile...</p>
    </mat-card-content>
  </mat-card>
</div>
