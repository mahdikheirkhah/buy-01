# --- STAGE 1: Build the Angular App ---
FROM node:20-alpine AS build

# Set working directory
WORKDIR /app

# Copy package files and install dependencies
COPY frontend/package*.json .
RUN npm install

# Copy all source files and build the app
COPY frontend/ .
RUN npm run build -- --output-path=./dist

# --- STAGE 2: Serve the App using Nginx ---
FROM nginx:stable-alpine

# Copy the custom nginx configuration
# NOTE: You will need to create a simple nginx.conf if you haven't already.
# For local HTTPS/HTTP setup, a simple config is usually sufficient.
# Assuming a file named nginx.conf exists in the frontend/ folder.
COPY frontend/nginx.conf /etc/nginx/conf.d/default.conf

# Copy the built application files
COPY --from=build /app/dist/browser /usr/share/nginx/html

# Default Nginx port is 80, but we expose 443 for HTTPS if using a proxy.
EXPOSE 80
EXPOSE 443

CMD ["nginx", "-g", "daemon off;"]
